<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TVBOX接口配置编辑器</title>
    <style>
        :root {
            --primary-color: #4a6baf;
            --secondary-color: #5a8dee;
            --accent-color: #ff7043;
            --success-color: #4caf50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            --light-color: #f5f7fa;
            --dark-color: #263238;
            --text-color: #455a64;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f8f9fa;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            touch-action: manipulation;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 15px var(--shadow-color);
            overflow: hidden;
            padding: 25px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .warning {
            color: var(--danger-color);
            background-color: rgba(244, 67, 54, 0.1);
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 8px;
            background-color: var(--light-color);
            padding: 8px;
            border-radius: 6px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-color);
        }
        
        .tab-btn:hover {
            background-color: rgba(74, 107, 175, 0.1);
            color: var(--primary-color);
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(74, 107, 175, 0.3);
        }
        
        .instruction {
            color: var(--text-color);
            background-color: rgba(90, 141, 238, 0.1);
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 15px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .config-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .config-section.active {
            display: block;
        }
        
        .config-section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            font-size: 20px;
        }
        
        .config-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .config-label {
            min-width: 120px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            flex: 1;
            min-width: 250px;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(90, 141, 238, 0.2);
        }
        
        textarea {
            min-height: 120px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            line-height: 1.5;
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(74, 107, 175, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .button-edit {
            background-color: var(--info-color);
        }
        
        .button-cancel {
            background-color: var(--danger-color);
        }
        
        .button-success {
            background-color: var(--success-color);
        }
        
        .button-warning {
            background-color: var(--warning-color);
        }
        
        .source-list {
            margin-top: 25px;
            width: 100%;
        }
        
        .source-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
            position: relative;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .source-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .source-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        .drag-handle {
            margin-right: 15px;
            cursor: move;
            color: var(--text-color);
            font-size: 18px;
        }
        
        .source-item h4 {
            color: var(--dark-color);
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .source-item p {
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .source-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .category-config {
            margin-top: 20px;
            width: 100%;
        }
        
        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .category-tag {
            background-color: rgba(90, 141, 238, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            font-size: 13px;
            color: var(--primary-color);
        }
        
        .category-tag button {
            margin-left: 8px;
            padding: 2px 6px;
            background-color: var(--danger-color);
            font-size: 12px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            min-width: auto;
        }
        
        .url-list {
            margin-top: 15px;
            width: 100%;
        }
        
        .url-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .url-item input {
            flex: 1;
        }
        
        .url-item button {
            padding: 8px 12px;
            min-width: auto;
        }
        
        .json-output {
            margin-top: 30px;
            width: 100%;
        }
        
        .json-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .json-header h3 {
            color: var(--primary-color);
            font-size: 18px;
        }
        
        #config-json {
            width: 100%;
            height: 200px;
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .channel-item,
        .parse-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            cursor: move;
        }
        
        .channel-item.dragging,
        .parse-item.dragging {
            opacity: 0.7;
            border: 2px dashed var(--primary-color);
            background-color: rgba(90, 141, 238, 0.1);
        }
        
        .channel-item p,
        .parse-item p {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .channel-item-actions,
        .parse-item-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 8px;
        }
        
        .ijk-option-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .ijk-option-item select,
        .ijk-option-item input {
            flex: 1;
            min-width: 200px;
        }
        
        .ijk-option-item button {
            padding: 8px 12px;
            min-width: auto;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .config-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .config-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            input[type="text"],
            input[type="number"],
            select,
            textarea {
                width: 100%;
                min-width: 100%;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
            }
            
            .json-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .ijk-option-item select,
            .ijk-option-item input {
                width: 100%;
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TVBOX接口配置编辑器</h1>
            <div class="warning">返回或者关闭浏览器将会丢失记录，谨慎操作！</div>
        </div>

        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="vod">点播源</button>
            <button class="tab-btn" data-tab="live">直播源</button>
            <button class="tab-btn" data-tab="parse">解析地址</button>
            <button class="tab-btn" data-tab="vip">VIP解析标识</button>
            <button class="tab-btn" data-tab="ijk">IJK解码配置</button>
            <button class="tab-btn" data-tab="ad">解析广告过滤</button>
            <button class="tab-btn" data-tab="wallpaper">壁纸</button>
        </div>

        <div class="instruction">
            <i class="icon-info"></i> 配置好后点击"添加点播源"按钮，然后复制到剪贴板即可！
        </div>

        <div class="config-section active" id="vod-config">
            <h3>点播源配置</h3>
            <div class="config-row">
                <div class="config-label">Spider:</div>
                <input type="text" id="global-spider" placeholder="自定义爬虫jar代码包(不需要留空即可)">
            </div>
            <div class="config-row">
                <div class="config-label">Key:</div>
                <input type="text" id="vod-key" placeholder="点播源key">
            </div>
            <div class="config-row">
                <div class="config-label">Name:</div>
                <input type="text" id="vod-name" placeholder="点播源名称">
            </div>
            <div class="config-row">
                <div class="config-label">Type:</div>
                <select id="vod-type">
                    <option value="0">0-xml</option>
                    <option value="1" selected>1-json</option>
                    <option value="2">2-爬虫源</option>
                    <option value="3">3-自定义爬虫</option>
                    <option value="4">4-服务器爬虫</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">API:</div>
                <input type="text" id="vod-api" placeholder="API地址">
            </div>
            <div class="config-row">
                <div class="config-label">JAR:</div>
                <input type="text" id="vod-jar" placeholder="自定义JAR包地址(不需要留空即可)">
            </div>
            <div class="config-row">
                <div class="config-label">可搜索:</div>
                <select id="vod-searchable">
                    <option value="0">0-不可以</option>
                    <option value="1" selected>1-可以</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">可快速搜索:</div>
                <select id="vod-quickSearch">
                    <option value="0">0-不可以</option>
                    <option value="1" selected>1-可以</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">可筛选:</div>
                <select id="vod-filterable">
                    <option value="0">0-不可以</option>
                    <option value="1" selected>1-可以</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">Ext:</div>
                <input type="text" id="vod-ext" placeholder="扩展参数(可选)">
            </div>
            
            <div class="category-config">
                <h3>分类配置</h3>
                <p>按顺序展示所配置的分类，不配置则默认展示所有分类</p>
                <div class="config-row">
                    <div class="config-label">添加分类:</div>
                    <select id="category-select">
                        <option value="电影">电影</option>
                        <option value="电视剧">电视剧</option>
                        <option value="动漫">动漫</option>
                        <option value="综艺">综艺</option>
                        <option value="短剧">短剧</option>
                        <option value="纪录片">纪录片</option>
                    </select>
                    <button id="add-category-btn">添加</button>
                </div>
                <div class="category-list" id="categories-list"></div>
            </div>
        </div>

        <div class="source-list" id="vod-list">
            <div class="button-group">
                <button id="add-vod-btn" class="button-success">添加点播源</button>
                <button id="update-vod-btn" class="button-edit" style="display:none;">更新点播源</button>
                <button id="cancel-edit-btn" class="button-cancel" style="display:none;">取消编辑</button>
            </div>
            <div id="vod-items"></div>
        </div>

        <div class="config-section" id="live-config">
            <h3>直播源配置</h3>
            <div class="config-row">
                <div class="config-label">组名:</div>
                <input type="text" id="live-group" placeholder="Group">
            </div>
            <div class="config-row">
                <div class="config-label">频道名:</div>
                <input type="text" id="live-channel-name" placeholder="name">
            </div>
            <div class="config-row">
                <div class="config-label">直播源Urls:</div>
                <div style="flex: 1;">
                    <div class="url-list" id="live-urls-list">
                        <div class="url-item">
                            <input type="text" class="live-url" placeholder="直播源Urls">
                            <button class="remove-url button-cancel">删除</button>
                        </div>
                    </div>
                    <button id="add-url-btn" class="button-success" style="margin-top: 10px;">添加Urls</button>
                </div>
            </div>
            <div class="button-group">
                <button id="add-live-channel-btn" class="button-success">添加频道</button>
                <button id="update-live-channel-btn" class="button-edit" style="display:none;">更新频道</button>
                <button id="cancel-live-edit-btn" class="button-cancel" style="display:none;">取消编辑</button>
            </div>
            <div id="live-channels-list"></div>
        </div>

        <div class="config-section" id="parse-config">
            <h3>解析地址配置</h3>
            <div class="config-row">
                <div class="config-label">解析名称:</div>
                <input type="text" id="parse-name" placeholder="解析名称">
            </div>
            <div class="config-row">
                <div class="config-label">解析类型:</div>
                <select id="parse-type">
                    <option value="0" selected>Type-0 (普通)</option>
                    <option value="1">Type-1 (json)</option>
                    <option value="2">Type-2 (多json)</option>
                    <option value="3">Type-3 (聚合)</option>
                </select>
            </div>
            <div class="config-row">
                <div class="config-label">解析URL:</div>
                <input type="text" id="parse-url" placeholder="解析URL">
            </div>
            <div class="config-row">
                <div class="config-label">Ext:</div>
                <input type="text" id="parse-ext" placeholder="扩展参数(可选)">
            </div>
            <div class="button-group">
                <button id="add-parse-btn" class="button-success">添加解析</button>
                <button id="update-parse-btn" class="button-edit" style="display:none;">更新解析</button>
                <button id="cancel-parse-edit-btn" class="button-cancel" style="display:none;">取消编辑</button>
            </div>
            <div id="parse-list"></div>
        </div>

        <div class="config-section" id="vip-config">
            <h3>VIP解析标识</h3>
            <div class="config-row">
                <div class="config-label">VIP标识:</div>
                <textarea id="vip-flags" placeholder="多个标识用逗号分隔">youku,qq,iqiyi,qiyi,letv,sohu,tudou,pptv,mgtv,wasu</textarea>
            </div>
        </div>

        <div class="config-section" id="ijk-config">
            <h3>IJK解码配置</h3>
            <div class="config-row">
                <div class="config-label">解码组:</div>
                <select id="ijk-group">
                    <option value="soft">软解码</option>
                    <option value="hard">硬解码</option>
                </select>
            </div>
            
            <div class="config-row">
                <div class="config-label">添加解码选项:</div>
                <div style="flex: 1;">
                    <div id="ijk-new-options">
                        <div class="ijk-option-item">
                            <select class="ijk-category">
                                <option value="1">1-OPT_CATEGORY_FORMAT</option>
                                <option value="2">2-OPT_CATEGORY_CODEC</option>
                                <option value="3">3-OPT_CATEGORY_SWS</option>
                                <option value="4" selected>4-OPT_CATEGORY_PLAYER</option>
                            </select>
                            <input type="text" class="ijk-name" placeholder="属性名称" list="ijk-names">
                            <input type="text" class="ijk-value" placeholder="属性值">
                            <button class="add-ijk-option button-success">添加</button>
                            <button class="update-ijk-option button-edit" style="display:none;">更新</button>
                            <button class="cancel-ijk-edit button-cancel" style="display:none;">取消</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <datalist id="ijk-names">
                <option value="opensles">
                <option value="overlay-format">
                <option value="framedrop">
                <option value="soundtouch">
                <option value="start-on-prepared">
                <option value="http-detect-range-support">
                <option value="fflags">
                <option value="skip_loop_filter">
                <option value="reconnect">
                <option value="max-buffer-size">
                <option value="enable-accurate-seek">
                <option value="mediacodec">
                <option value="mediacodec-auto-rotate">
                <option value="mediacodec-handle-resolution-change">
                <option value="mediacodec-hevc">
            </datalist>
            
            <div class="config-row">
                <div class="config-label">当前解码选项:</div>
                <textarea id="ijk-options" placeholder="每行一个配置项，格式:category|name|value"></textarea>
            </div>
            
            <div id="ijk-options-list"></div>
        </div>

        <div class="config-section" id="ad-config">
            <h3>解析广告过滤</h3>
            <div class="config-row">
                <div class="config-label">广告域名:</div>
                <textarea id="ad-domains" placeholder="每行一个广告域名">mimg.0c1q0l.cn
www.googletagmanager.com
www.google-analytics.com
mc.usihnbcq.cn
mg.g1mm3d.cn
mscs.svaeuzh.cn
cnzz.hhttm.top
tp.vinuxhome.com
cnzz.mmstat.com
www.baihuillq.com
s23.cnzz.com
z3.cnzz.com
c.cnzz.com
stj.v1vo.top
z12.cnzz.com
img.mosflower.cn
tips.gamevvip.com
ehwe.yhdtns.com
xdn.cqqc3.com
www.jixunkyy.cn
sp.chemacid.cn
hm.baidu.com
s9.cnzz.com
z6.cnzz.com
um.cavuc.com
mav.mavuz.com
wofwk.aoidf3.com
z5.cnzz.com
xc.hubeijieshikj.cn
tj.tianwenhu.com
xg.gars57.cn
k.jinxiuzhilv.com
cdn.bootcss.com
ppl.xunzhuo123.com
xomk.jiangjunmh.top
img.xunzhuo123.com
z1.cnzz.com
s13.cnzz.com
xg.huataisangao.cn
z7.cnzz.com
xg.huataisangao.cn
z2.cnzz.com
s96.cnzz.com
q11.cnzz.com
thy.dacedsfa.cn
xg.whsbpw.cn
s19.cnzz.com
z8.cnzz.com
s4.cnzz.com
f5w.as12df.top
ae01.alicdn.com
www.92424.cn
k.wudejia.com
vivovip.mmszxc.top
qiu.xixiqiu.com
cdnjs.hnfenxun.com
cms.qdwght.com</textarea>
            </div>
        </div>

        <div class="config-section" id="wallpaper-config">
            <h3>壁纸配置</h3>
            <div class="config-row">
                <div class="config-label">壁纸URL:</div>
                <input type="text" id="wallpaper-url" placeholder="壁纸URL">
            </div>
        </div>

        <div class="json-output">
            <div class="json-header">
                <h3>生成的配置JSON</h3>
                <button id="copy-btn" class="button-success">复制到剪贴板</button>
            </div>
            <textarea id="config-json" readonly></textarea>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化配置数据
            let config = {
                "spider": "",
                "sites": [],
                "lives": [],
                "parses": [],
                "flags": [
                    "youku",
                    "qq",
                    "iqiyi",
                    "qiyi",
                    "letv",
                    "sohu",
                    "tudou",
                    "pptv",
                    "mgtv",
                    "wasu"
                ],
                "categories": ["电影", "电视剧", "动漫", "综艺", "短剧", "纪录片"],
                "ijk": [
                    {
                        "group": "软解码",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "0"
                            }
                        ]
                    },
                    {
                        "group": "硬解码",
                        "options": [
                            {
                                "category": 4,
                                "name": "opensles",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "overlay-format",
                                "value": "842225234"
                            },
                            {
                                "category": 4,
                                "name": "framedrop",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "soundtouch",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "start-on-prepared",
                                "value": "1"
                            },
                            {
                                "category": 1,
                                "name": "http-detect-range-support",
                                "value": "0"
                            },
                            {
                                "category": 1,
                                "name": "fflags",
                                "value": "fastseek"
                            },
                            {
                                "category": 2,
                                "name": "skip_loop_filter",
                                "value": "48"
                            },
                            {
                                "category": 4,
                                "name": "reconnect",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "max-buffer-size",
                                "value": "5242880"
                            },
                            {
                                "category": 4,
                                "name": "enable-accurate-seek",
                                "value": "0"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-auto-rotate",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-handle-resolution-change",
                                "value": "1"
                            },
                            {
                                "category": 4,
                                "name": "mediacodec-hevc",
                                "value": "1"
                            }
                        ]
                    }
                ],
                "ads": [
                    "mimg.0c1q0l.cn",
                    "www.googletagmanager.com",
                    "www.google-analytics.com",
                    "mc.usihnbcq.cn",
                    "mg.g1mm3d.cn",
                    "mscs.svaeuzh.cn",
                    "cnzz.hhttm.top",
                    "tp.vinuxhome.com",
                    "cnzz.mmstat.com",
                    "www.baihuillq.com",
                    "s23.cnzz.com",
                    "z3.cnzz.com",
                    "c.cnzz.com",
                    "stj.v1vo.top",
                    "z12.cnzz.com",
                    "img.mosflower.cn",
                    "tips.gamevvip.com",
                    "ehwe.yhdtns.com",
                    "xdn.cqqc3.com",
                    "www.jixunkyy.cn",
                    "sp.chemacid.cn",
                    "hm.baidu.com",
                    "s9.cnzz.com",
                    "z6.cnzz.com",
                    "um.cavuc.com",
                    "mav.mavuz.com",
                    "wofwk.aoidf3.com",
                    "z5.cnzz.com",
                    "xc.hubeijieshikj.cn",
                    "tj.tianwenhu.com",
                    "xg.gars57.cn",
                    "k.jinxiuzhilv.com",
                    "cdn.bootcss.com",
                    "ppl.xunzhuo123.com",
                    "xomk.jiangjunmh.top",
                    "img.xunzhuo123.com",
                    "z1.cnzz.com",
                    "s13.cnzz.com",
                    "xg.huataisangao.cn",
                    "z7.cnzz.com",
                    "xg.huataisangao.cn",
                    "z2.cnzz.com",
                    "s96.cnzz.com",
                    "q11.cnzz.com",
                    "thy.dacedsfa.cn",
                    "xg.whsbpw.cn",
                    "s19.cnzz.com",
                    "z8.cnzz.com",
                    "s4.cnzz.com",
                    "f5w.as12df.top",
                    "ae01.alicdn.com",
                    "www.92424.cn",
                    "k.wudejia.com",
                    "vivovip.mmszxc.top",
                    "qiu.xixiqiu.com",
                    "cdnjs.hnfenxun.com",
                    "cms.qdwght.com"
                ],
                "wallpaper": ""
            };

            // DOM元素
            const tabBtns = document.querySelectorAll('.tab-btn');
            const addVodBtn = document.getElementById('add-vod-btn');
            const updateVodBtn = document.getElementById('update-vod-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const addLiveChannelBtn = document.getElementById('add-live-channel-btn');
            const updateLiveChannelBtn = document.getElementById('update-live-channel-btn');
            const cancelLiveEditBtn = document.getElementById('cancel-live-edit-btn');
            const addParseBtn = document.getElementById('add-parse-btn');
            const updateParseBtn = document.getElementById('update-parse-btn');
            const cancelParseEditBtn = document.getElementById('cancel-parse-edit-btn');
            const addUrlBtn = document.getElementById('add-url-btn');
            const copyBtn = document.getElementById('copy-btn');
            const configJson = document.getElementById('config-json');
            const vodItems = document.getElementById('vod-items');
            const liveChannelsList = document.getElementById('live-channels-list');
            const parseList = document.getElementById('parse-list');
            const liveUrlsList = document.getElementById('live-urls-list');
            const addCategoryBtn = document.getElementById('add-category-btn');
            const categorySelect = document.getElementById('category-select');
            const categoriesList = document.getElementById('categories-list');
            const parseUrlInput = document.getElementById('parse-url');
            const parseExtInput = document.getElementById('parse-ext');
            const wallpaperUrlInput = document.getElementById('wallpaper-url');
            const liveGroupInput = document.getElementById('live-group');
            const liveChannelNameInput = document.getElementById('live-channel-name');
            const vipFlagsInput = document.getElementById('vip-flags');
            const ijkGroupSelect = document.getElementById('ijk-group');
            const ijkOptionsTextarea = document.getElementById('ijk-options');
            const adDomainsTextarea = document.getElementById('ad-domains');
            const globalSpiderInput = document.getElementById('global-spider');
            const vodExtInput = document.getElementById('vod-ext');
            const vodJarInput = document.getElementById('vod-jar');
            const addIjkOptionBtn = document.querySelector('.add-ijk-option');
            const updateIjkOptionBtn = document.querySelector('.update-ijk-option');
            const cancelIjkEditBtn = document.querySelector('.cancel-ijk-edit');
            const ijkCategorySelect = document.querySelector('.ijk-category');
            const ijkNameInput = document.querySelector('.ijk-name');
            const ijkValueInput = document.querySelector('.ijk-value');
            const ijkOptionsList = document.getElementById('ijk-options-list');

            // 编辑相关变量
            let draggedItem = null;
            let dragStartIndex = -1;
            let editingIndex = -1;
            let editingLiveGroupIndex = -1;
            let editingLiveChannelIndex = -1;
            let editingParseIndex = -1;
            let editingIjkOptionIndex = -1;
            let currentIjkGroup = 'soft';

            // 标签页切换
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    tabBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.config-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(`${tab}-config`).classList.add('active');
                });
            });

            // 添加点播源
            addVodBtn.addEventListener('click', function() {
                const key = document.getElementById('vod-key').value.trim();
                const name = document.getElementById('vod-name').value.trim();
                const api = document.getElementById('vod-api').value.trim();
                const jar = vodJarInput.value.trim();
                const ext = vodExtInput.value.trim();
                
                if (!key || !name || !api) {
                    alert('请填写完整的点播源信息!');
                    return;
                }
                
                const newSite = {
                    key: key,
                    name: name,
                    type: parseInt(document.getElementById('vod-type').value),
                    api: api,
                    searchable: parseInt(document.getElementById('vod-searchable').value),
                    quickSearch: parseInt(document.getElementById('vod-quickSearch').value),
                    filterable: parseInt(document.getElementById('vod-filterable').value)
                };
                
                if (jar) {
                    newSite.jar = jar;
                }
                
                if (ext) {
                    newSite.ext = ext;
                }
                
                if (config.categories && config.categories.length > 0) {
                    newSite.categories = [...config.categories];
                }
                
                config.sites.push(newSite);
                updateConfigJson();
                loadVodItems();
                
                clearVodForm();
            });

            // 更新点播源
            updateVodBtn.addEventListener('click', function() {
                if (editingIndex === -1) return;
                
                const key = document.getElementById('vod-key').value.trim();
                const name = document.getElementById('vod-name').value.trim();
                const api = document.getElementById('vod-api').value.trim();
                const jar = vodJarInput.value.trim();
                const ext = vodExtInput.value.trim();
                
                if (!key || !name || !api) {
                    alert('请填写完整的点播源信息!');
                    return;
                }
                
                const updatedSite = {
                    key: key,
                    name: name,
                    type: parseInt(document.getElementById('vod-type').value),
                    api: api,
                    searchable: parseInt(document.getElementById('vod-searchable').value),
                    quickSearch: parseInt(document.getElementById('vod-quickSearch').value),
                    filterable: parseInt(document.getElementById('vod-filterable').value)
                };
                
                if (jar) {
                    updatedSite.jar = jar;
                }
                
                if (ext) {
                    updatedSite.ext = ext;
                }
                
                if (config.categories && config.categories.length > 0) {
                    updatedSite.categories = [...config.categories];
                }
                
                config.sites[editingIndex] = updatedSite;
                updateConfigJson();
                loadVodItems();
                
                cancelEdit();
            });

            // 取消编辑
            cancelEditBtn.addEventListener('click', function() {
                cancelEdit();
            });

            function cancelEdit() {
                editingIndex = -1;
                addVodBtn.style.display = 'inline-block';
                updateVodBtn.style.display = 'none';
                cancelEditBtn.style.display = 'none';
                clearVodForm();
            }

            function clearVodForm() {
                document.getElementById('vod-key').value = '';
                document.getElementById('vod-name').value = '';
                document.getElementById('vod-api').value = '';
                vodJarInput.value = '';
                vodExtInput.value = '';
            }

            // 添加Urls按钮
            addUrlBtn.addEventListener('click', function() {
                const urlItem = document.createElement('div');
                urlItem.className = 'url-item';
                urlItem.innerHTML = `
                    <input type="text" class="live-url" placeholder="直播源Urls">
                    <button class="remove-url button-cancel">删除</button>
                `;
                liveUrlsList.appendChild(urlItem);
                
                urlItem.querySelector('.remove-url').addEventListener('click', function() {
                    urlItem.remove();
                });
            });

            // 添加直播频道
            addLiveChannelBtn.addEventListener('click', function() {
                const group = liveGroupInput.value.trim();
                const name = liveChannelNameInput.value.trim();
                const urlInputs = document.querySelectorAll('.live-url');
                const urls = Array.from(urlInputs).map(input => input.value.trim()).filter(url => url);
                
                if (!group || !name || urls.length === 0) {
                    alert('请填写完整的直播频道信息!');
                    return;
                }
                
                let liveGroup = config.lives.find(g => g.group === group);
                
                if (!liveGroup) {
                    liveGroup = {
                        group: group,
                        channels: []
                    };
                    config.lives.push(liveGroup);
                }
                
                liveGroup.channels.push({
                    name: name,
                    urls: urls
                });
                
                updateConfigJson();
                loadLiveChannels();
                
                clearLiveForm();
            });

            // 更新直播频道
            updateLiveChannelBtn.addEventListener('click', function() {
                if (editingLiveGroupIndex === -1 || editingLiveChannelIndex === -1) return;
                
                const group = liveGroupInput.value.trim();
                const name = liveChannelNameInput.value.trim();
                const urlInputs = document.querySelectorAll('.live-url');
                const urls = Array.from(urlInputs).map(input => input.value.trim()).filter(url => url);
                
                if (!group || !name || urls.length === 0) {
                    alert('请填写完整的直播频道信息!');
                    return;
                }
                
                // 如果组名改变了，需要创建新组
                if (group !== config.lives[editingLiveGroupIndex].group) {
                    // 从原组删除
                    config.lives[editingLiveGroupIndex].channels.splice(editingLiveChannelIndex, 1);
                    
                    // 如果原组空了，删除组
                    if (config.lives[editingLiveGroupIndex].channels.length === 0) {
                        config.lives.splice(editingLiveGroupIndex, 1);
                    }
                    
                    // 查找或创建新组
                    let newGroup = config.lives.find(g => g.group === group);
                    if (!newGroup) {
                        newGroup = {
                            group: group,
                            channels: []
                        };
                        config.lives.push(newGroup);
                    }
                    
                    // 添加到新组
                    newGroup.channels.push({
                        name: name,
                        urls: urls
                    });
                } else {
                    // 组名没变，直接更新
                    config.lives[editingLiveGroupIndex].channels[editingLiveChannelIndex] = {
                        name: name,
                        urls: urls
                    };
                }
                
                updateConfigJson();
                loadLiveChannels();
                
                cancelLiveEdit();
            });

            // 取消直播编辑
            cancelLiveEditBtn.addEventListener('click', function() {
                cancelLiveEdit();
            });

            function cancelLiveEdit() {
                editingLiveGroupIndex = -1;
                editingLiveChannelIndex = -1;
                addLiveChannelBtn.style.display = 'inline-block';
                updateLiveChannelBtn.style.display = 'none';
                cancelLiveEditBtn.style.display = 'none';
                clearLiveForm();
            }

            function clearLiveForm() {
                liveGroupInput.value = '';
                liveChannelNameInput.value = '';
                liveUrlsList.innerHTML = `
                    <div class="url-item">
                        <input type="text" class="live-url" placeholder="直播源Urls">
                        <button class="remove-url button-cancel">删除</button>
                    </div>
                `;
                
                document.querySelectorAll('.remove-url').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.parentElement.remove();
                    });
                });
            }

            // 添加解析地址
            addParseBtn.addEventListener('click', function() {
                const name = document.getElementById('parse-name').value.trim();
                const type = parseInt(document.getElementById('parse-type').value);
                const url = parseUrlInput.value.trim();
                const ext = parseExtInput.value.trim();
                
                if (!name || !url) {
                    alert('请填写完整的解析地址信息!');
                    return;
                }
                
                const newParse = {
                    name: name,
                    type: type,
                    url: url
                };
                
                if (ext) {
                    newParse.ext = ext;
                }
                
                config.parses.push(newParse);
                
                updateConfigJson();
                loadParses();
                
                clearParseForm();
            });

            // 更新解析地址
            updateParseBtn.addEventListener('click', function() {
                if (editingParseIndex === -1) return;
                
                const name = document.getElementById('parse-name').value.trim();
                const type = parseInt(document.getElementById('parse-type').value);
                const url = parseUrlInput.value.trim();
                const ext = parseExtInput.value.trim();
                
                if (!name || !url) {
                    alert('请填写完整的解析地址信息!');
                    return;
                }
                
                const updatedParse = {
                    name: name,
                    type: type,
                    url: url
                };
                
                if (ext) {
                    updatedParse.ext = ext;
                }
                
                config.parses[editingParseIndex] = updatedParse;
                
                updateConfigJson();
                loadParses();
                
                cancelParseEdit();
            });

            // 取消解析编辑
            cancelParseEditBtn.addEventListener('click', function() {
                cancelParseEdit();
            });

            function cancelParseEdit() {
                editingParseIndex = -1;
                addParseBtn.style.display = 'inline-block';
                updateParseBtn.style.display = 'none';
                cancelParseEditBtn.style.display = 'none';
                clearParseForm();
            }

            function clearParseForm() {
                document.getElementById('parse-name').value = '';
                document.getElementById('parse-type').value = '0';
                parseUrlInput.value = '';
                parseExtInput.value = '';
            }

            // 添加分类
            addCategoryBtn.addEventListener('click', function() {
                const category = categorySelect.value;
                if (!config.categories) {
                    config.categories = [];
                }
                
                if (!config.categories.includes(category)) {
                    config.categories.push(category);
                    updateConfigJson();
                    loadCategories();
                }
            });

            // 添加IJK解码选项
            addIjkOptionBtn.addEventListener('click', function() {
                const group = ijkGroupSelect.value;
                const category = ijkCategorySelect.value;
                const name = ijkNameInput.value.trim();
                const value = ijkValueInput.value.trim();
                
                if (!name || !value) {
                    alert('请填写完整的解码选项信息!');
                    return;
                }
                
                // 找到对应的解码组
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (!ijkGroup) {
                    alert('找不到对应的解码组!');
                    return;
                }
                
                // 添加新选项
                ijkGroup.options.push({
                    category: parseInt(category),
                    name: name,
                    value: value
                });
                
                // 更新文本区域显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // 清空输入框
                clearIjkForm();
                
                // 自动更新配置
                updateConfigJson();
            });

            // 更新IJK解码选项
            updateIjkOptionBtn.addEventListener('click', function() {
                if (editingIjkOptionIndex === -1) return;
                
                const group = ijkGroupSelect.value;
                const category = ijkCategorySelect.value;
                const name = ijkNameInput.value.trim();
                const value = ijkValueInput.value.trim();
                
                if (!name || !value) {
                    alert('请填写完整的解码选项信息!');
                    return;
                }
                
                // 找到对应的解码组
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (!ijkGroup) {
                    alert('找不到对应的解码组!');
                    return;
                }
                
                // 更新选项
                ijkGroup.options[editingIjkOptionIndex] = {
                    category: parseInt(category),
                    name: name,
                    value: value
                };
                
                // 更新文本区域显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // 取消编辑状态
                cancelIjkEdit();
                
                // 自动更新配置
                updateConfigJson();
            });

            // 取消IJK编辑
            cancelIjkEditBtn.addEventListener('click', function() {
                cancelIjkEdit();
            });

            function cancelIjkEdit() {
                editingIjkOptionIndex = -1;
                addIjkOptionBtn.style.display = 'inline-block';
                updateIjkOptionBtn.style.display = 'none';
                cancelIjkEditBtn.style.display = 'none';
                clearIjkForm();
            }

            function clearIjkForm() {
                ijkCategorySelect.value = '4';
                ijkNameInput.value = '';
                ijkValueInput.value = '';
            }

            // 更新IJK选项文本区域
            function updateIjkOptionsTextarea() {
                const group = ijkGroupSelect.value;
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (ijkGroup) {
                    ijkOptionsTextarea.value = 
                        ijkGroup.options.map(opt => `${opt.category}|${opt.name}|${opt.value}`).join('\n');
                }
            }

            // 加载IJK选项列表
            function loadIjkOptions() {
                ijkOptionsList.innerHTML = '';
                
                const group = ijkGroupSelect.value;
                const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                
                if (!ijkGroup || ijkGroup.options.length === 0) {
                    return;
                }
                
                ijkGroup.options.forEach((option, index) => {
                    const item = document.createElement('div');
                    item.className = 'ijk-option-item';
                    item.innerHTML = `
                        <select disabled>
                            <option value="1" ${option.category === 1 ? 'selected' : ''}>1-OPT_CATEGORY_FORMAT</option>
                            <option value="2" ${option.category === 2 ? 'selected' : ''}>2-OPT_CATEGORY_CODEC</option>
                            <option value="3" ${option.category === 3 ? 'selected' : ''}>3-OPT_CATEGORY_SWS</option>
                            <option value="4" ${option.category === 4 ? 'selected' : ''}>4-OPT_CATEGORY_PLAYER</option>
                        </select>
                        <input type="text" value="${option.name}" disabled>
                        <input type="text" value="${option.value}" disabled>
                        <button class="button-edit edit-ijk-option" data-index="${index}">编辑</button>
                        <button class="button-cancel delete-ijk-option" data-index="${index}">删除</button>
                    `;
                    ijkOptionsList.appendChild(item);
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-ijk-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const group = ijkGroupSelect.value;
                        const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                        const option = ijkGroup.options[index];
                        
                        // 填充表单
                        ijkCategorySelect.value = option.category;
                        ijkNameInput.value = option.name;
                        ijkValueInput.value = option.value;
                        
                        // 切换按钮状态
                        editingIjkOptionIndex = index;
                        addIjkOptionBtn.style.display = 'none';
                        updateIjkOptionBtn.style.display = 'inline-block';
                        cancelIjkEditBtn.style.display = 'inline-block';
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-ijk-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const group = ijkGroupSelect.value;
                        const ijkGroup = config.ijk.find(g => g.group === (group === 'soft' ? '软解码' : '硬解码'));
                        
                        ijkGroup.options.splice(index, 1);
                        
                        // 更新文本区域显示
                        updateIjkOptionsTextarea();
                        loadIjkOptions();
                        updateConfigJson();
                    });
                });
            }

            // IJK解码组切换
            ijkGroupSelect.addEventListener('change', function() {
                updateIjkOptionsTextarea();
                loadIjkOptions();
                clearIjkForm();
            });

            // 加载分类列表
            function loadCategories() {
                categoriesList.innerHTML = '';
                
                if (!config.categories || config.categories.length === 0) {
                    return;
                }
                
                config.categories.forEach((category, index) => {
                    const tag = document.createElement('div');
                    tag.className = 'category-tag';
                    tag.innerHTML = `
                        ${category}
                        <button data-index="${index}" class="delete-category">×</button>
                    `;
                    categoriesList.appendChild(tag);
                });
                
                document.querySelectorAll('.delete-category').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.categories.splice(index, 1);
                        updateConfigJson();
                        loadCategories();
                    });
                });
            }

            // 加载点播源列表
            function loadVodItems() {
                vodItems.innerHTML = '';
                
                if (config.sites.length === 0) {
                    return;
                }
                
                config.sites.forEach((site, index) => {
                    const item = document.createElement('div');
                    item.className = 'source-item';
                    item.draggable = true;
                    item.dataset.index = index;
                    
                    let categoriesHtml = '';
                    if (site.categories && site.categories.length > 0) {
                        categoriesHtml = `<p>分类: ${site.categories.join(', ')}</p>`;
                    }
                    
                    let jarHtml = site.jar ? `<p>JAR: ${site.jar}</p>` : '';
                    let extHtml = site.ext ? `<p>Ext: ${site.ext}</p>` : '';
                    
                    item.innerHTML = `
                        <span class="drag-handle">☰</span>
                        <div style="flex: 1;">
                            <h4>${site.name} (${site.key})</h4>
                            <p>API: ${site.api}</p>
                            ${jarHtml}
                            <p>类型: ${getTypeName(site.type)} | 可搜索: ${site.searchable} | 可快速搜索: ${site.quickSearch} | 可筛选: ${site.filterable}</p>
                            ${extHtml}
                            ${categoriesHtml}
                        </div>
                        <div class="source-item-actions">
                            <button data-index="${index}" class="button-edit edit-vod">编辑</button>
                            <button data-index="${index}" class="button-cancel delete-vod">删除</button>
                        </div>
                    `;
                    vodItems.appendChild(item);
                    
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('dragleave', handleDragLeave);
                    item.addEventListener('drop', handleDrop);
                    item.addEventListener('dragend', handleDragEnd);
                    
                    const dragHandle = item.querySelector('.drag-handle');
                    dragHandle.addEventListener('mousedown', function() {
                        item.draggable = true;
                    });
                    dragHandle.addEventListener('mouseup', function() {
                        item.draggable = false;
                    });
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-vod').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const site = config.sites[index];
                        
                        // 填充表单
                        document.getElementById('vod-key').value = site.key;
                        document.getElementById('vod-name').value = site.name;
                        document.getElementById('vod-type').value = site.type;
                        document.getElementById('vod-api').value = site.api;
                        vodJarInput.value = site.jar || '';
                        document.getElementById('vod-searchable').value = site.searchable;
                        document.getElementById('vod-quickSearch').value = site.quickSearch;
                        document.getElementById('vod-filterable').value = site.filterable;
                        vodExtInput.value = site.ext || '';
                        
                        // 更新分类
                        if (site.categories && site.categories.length > 0) {
                            config.categories = [...site.categories];
                            loadCategories();
                        }
                        
                        // 切换按钮状态
                        editingIndex = index;
                        addVodBtn.style.display = 'none';
                        updateVodBtn.style.display = 'inline-block';
                        cancelEditBtn.style.display = 'inline-block';
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-vod').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.sites.splice(index, 1);
                        updateConfigJson();
                        loadVodItems();
                    });
                });
            }
            
            // 加载直播频道列表
            function loadLiveChannels() {
                liveChannelsList.innerHTML = '';
                
                if (config.lives.length === 0) {
                    return;
                }
                
                config.lives.forEach((group, groupIndex) => {
                    const groupHeader = document.createElement('h4');
                    groupHeader.textContent = `组名: ${group.group}`;
                    groupHeader.style.marginTop = '20px';
                    groupHeader.style.marginBottom = '10px';
                    groupHeader.style.color = 'var(--primary-color)';
                    liveChannelsList.appendChild(groupHeader);
                    
                    group.channels.forEach((channel, channelIndex) => {
                        const item = document.createElement('div');
                        item.className = 'channel-item';
                        item.draggable = true;
                        item.dataset.group = groupIndex;
                        item.dataset.channel = channelIndex;
                        
                        let urlsHtml = '';
                        channel.urls.forEach((url, urlIndex) => {
                            urlsHtml += `<p>Urls: ${url}</p>`;  // 修改这里，将URL1改为Urls
                        });
                        
                        item.innerHTML = `
                            <div style="flex: 1;">
                                <p><strong>频道名:</strong> ${channel.name}</p>
                                ${urlsHtml}
                            </div>
                            <div class="channel-item-actions">
                                <button data-group="${groupIndex}" data-channel="${channelIndex}" class="button-edit edit-live-channel">编辑</button>
                                <button data-group="${groupIndex}" data-channel="${channelIndex}" class="button-cancel delete-live-channel">删除</button>
                            </div>
                        `;
                        liveChannelsList.appendChild(item);
                        
                        item.addEventListener('dragstart', handleLiveDragStart);
                        item.addEventListener('dragover', handleLiveDragOver);
                        item.addEventListener('dragleave', handleLiveDragLeave);
                        item.addEventListener('drop', handleLiveDrop);
                        item.addEventListener('dragend', handleLiveDragEnd);
                    });
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-live-channel').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const groupIndex = parseInt(this.dataset.group);
                        const channelIndex = parseInt(this.dataset.channel);
                        const channel = config.lives[groupIndex].channels[channelIndex];
                        
                        // 填充表单
                        liveGroupInput.value = config.lives[groupIndex].group;
                        liveChannelNameInput.value = channel.name;
                        
                        // 清空并添加URL输入框
                        liveUrlsList.innerHTML = '';
                        channel.urls.forEach(url => {
                            const urlItem = document.createElement('div');
                            urlItem.className = 'url-item';
                            urlItem.innerHTML = `
                                <input type="text" class="live-url" placeholder="直播源Urls" value="${url}">
                                <button class="remove-url button-cancel">删除</button>
                            `;
                            liveUrlsList.appendChild(urlItem);
                            
                            urlItem.querySelector('.remove-url').addEventListener('click', function() {
                                urlItem.remove();
                            });
                        });
                        
                        // 如果没有URL输入框，添加一个空的
                        if (liveUrlsList.children.length === 0) {
                            const urlItem = document.createElement('div');
                            urlItem.className = 'url-item';
                            urlItem.innerHTML = `
                                <input type="text" class="live-url" placeholder="直播源Urls">
                                <button class="remove-url button-cancel">删除</button>
                            `;
                            liveUrlsList.appendChild(urlItem);
                            
                            urlItem.querySelector('.remove-url').addEventListener('click', function() {
                                urlItem.remove();
                            });
                        }
                        
                        // 切换按钮状态
                        editingLiveGroupIndex = groupIndex;
                        editingLiveChannelIndex = channelIndex;
                        addLiveChannelBtn.style.display = 'none';
                        updateLiveChannelBtn.style.display = 'inline-block';
                        cancelLiveEditBtn.style.display = 'inline-block';
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-live-channel').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const groupIndex = parseInt(this.dataset.group);
                        const channelIndex = parseInt(this.dataset.channel);
                        
                        config.lives[groupIndex].channels.splice(channelIndex, 1);
                        
                        if (config.lives[groupIndex].channels.length === 0) {
                            config.lives.splice(groupIndex, 1);
                        }
                        
                        updateConfigJson();
                        loadLiveChannels();
                    });
                });
            }
            
            // 加载解析地址列表
            function loadParses() {
                parseList.innerHTML = '';
                
                if (config.parses.length === 0) {
                    return;
                }
                
                config.parses.forEach((parse, index) => {
                    const item = document.createElement('div');
                    item.className = 'parse-item';
                    item.draggable = true;
                    item.dataset.index = index;
                    
                    let extHtml = parse.ext ? `<p><strong>Ext:</strong> ${parse.ext}</p>` : '';
                    
                    item.innerHTML = `
                        <div style="flex: 1;">
                            <p><strong>名称:</strong> ${parse.name} (类型: ${getParseTypeName(parse.type)})</p>
                            <p><strong>URL:</strong> ${parse.url}</p>
                            ${extHtml}
                        </div>
                        <div class="parse-item-actions">
                            <button data-index="${index}" class="button-edit edit-parse">编辑</button>
                            <button data-index="${index}" class="button-cancel delete-parse">删除</button>
                        </div>
                    `;
                    parseList.appendChild(item);
                    
                    item.addEventListener('dragstart', handleParseDragStart);
                    item.addEventListener('dragover', handleParseDragOver);
                    item.addEventListener('dragleave', handleParseDragLeave);
                    item.addEventListener('drop', handleParseDrop);
                    item.addEventListener('dragend', handleParseDragEnd);
                });
                
                // 添加编辑事件
                document.querySelectorAll('.edit-parse').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        const parse = config.parses[index];
                        
                        // 填充表单
                        document.getElementById('parse-name').value = parse.name;
                        document.getElementById('parse-type').value = parse.type;
                        parseUrlInput.value = parse.url;
                        parseExtInput.value = parse.ext || '';
                        
                        // 切换按钮状态
                        editingParseIndex = index;
                        addParseBtn.style.display = 'none';
                        updateParseBtn.style.display = 'inline-block';
                        cancelParseEditBtn.style.display = 'inline-block';
                    });
                });
                
                // 添加删除事件
                document.querySelectorAll('.delete-parse').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        config.parses.splice(index, 1);
                        updateConfigJson();
                        loadParses();
                    });
                });
            }
            
            // 点播源拖动相关函数
            function handleDragStart(e) {
                draggedItem = this;
                dragStartIndex = parseInt(this.dataset.index);
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndIndex = parseInt(this.dataset.index);
                if (dragStartIndex !== dragEndIndex) {
                    const temp = config.sites[dragStartIndex];
                    config.sites[dragStartIndex] = config.sites[dragEndIndex];
                    config.sites[dragEndIndex] = temp;
                    
                    loadVodItems();
                    updateConfigJson();
                }
            }
            
            function handleDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            // 直播频道拖动相关函数
            function handleLiveDragStart(e) {
                draggedItem = this;
                const groupIndex = parseInt(this.dataset.group);
                const channelIndex = parseInt(this.dataset.channel);
                dragStartIndex = { group: groupIndex, channel: channelIndex };
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleLiveDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleLiveDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleLiveDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndGroupIndex = parseInt(this.dataset.group);
                const dragEndChannelIndex = parseInt(this.dataset.channel);
                
                if (dragStartIndex.group !== dragEndGroupIndex || dragStartIndex.channel !== dragEndChannelIndex) {
                    // 获取要移动的频道
                    const channelToMove = config.lives[dragStartIndex.group].channels[dragStartIndex.channel];
                    
                    // 从原位置删除
                    config.lives[dragStartIndex.group].channels.splice(dragStartIndex.channel, 1);
                    
                    // 如果原组空了，删除组
                    if (config.lives[dragStartIndex.group].channels.length === 0) {
                        config.lives.splice(dragStartIndex.group, 1);
                    }
                    
                    // 添加到新位置
                    const targetGroup = config.lives[dragEndGroupIndex];
                    targetGroup.channels.splice(dragEndChannelIndex, 0, channelToMove);
                    
                    loadLiveChannels();
                    updateConfigJson();
                }
            }
            
            function handleLiveDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            // 解析地址拖动相关函数
            function handleParseDragStart(e) {
                draggedItem = this;
                dragStartIndex = parseInt(this.dataset.index);
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
            }
            
            function handleParseDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                this.classList.add('drag-over');
            }
            
            function handleParseDragLeave() {
                this.classList.remove('drag-over');
            }
            
            function handleParseDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                const dragEndIndex = parseInt(this.dataset.index);
                if (dragStartIndex !== dragEndIndex) {
                    const temp = config.parses[dragStartIndex];
                    config.parses[dragStartIndex] = config.parses[dragEndIndex];
                    config.parses[dragEndIndex] = temp;
                    
                    loadParses();
                    updateConfigJson();
                }
            }
            
            function handleParseDragEnd() {
                this.classList.remove('dragging');
                draggedItem = null;
            }
            
            function getTypeName(type) {
                const types = {
                    0: 'xml',
                    1: 'json',
                    2: '爬虫源',
                    3: '自定义爬虫',
                    4: '服务器爬虫'
                };
                return types[type] || '未知';
            }
            
            function getParseTypeName(type) {
                const types = {
                    0: '普通',
                    1: 'json',
                    2: '多json',
                    3: '聚合'
                };
                return types[type] || '未知';
            }

            // 更新配置JSON显示
            function updateConfigJson() {
                const globalSpider = globalSpiderInput.value.trim();
                if (globalSpider) {
                    config.spider = globalSpider;
                } else {
                    config.spider = "";
                }
                
                config.flags = vipFlagsInput.value.split(',').map(f => f.trim()).filter(f => f);
                
                // 更新IJK配置时不再处理文本区域，因为现在直接操作config对象
                
                config.ads = adDomainsTextarea.value.split('\n').map(d => d.trim()).filter(d => d);
                
                const wallpaper = wallpaperUrlInput.value.trim();
                if (wallpaper) {
                    config.wallpaper = wallpaper;
                } else {
                    config.wallpaper = "";
                }
                
                configJson.value = JSON.stringify(config, null, 2);
            }
            
            // 复制到剪贴板
            copyBtn.addEventListener('click', async function() {
                if (!configJson.value) {
                    alert("错误：没有可复制的配置内容！");
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(configJson.value);
                    alert('✅ 配置已复制到剪贴板！');
                } catch (err) {
                    console.error("复制失败:", err);
                    configJson.select();
                    try {
                        const success = document.execCommand('copy');
                        alert(success ? '✅ 配置已复制（兼容模式）！' : '❌ 复制失败，请手动选择文本复制');
                    } catch (e) {
                        alert('❌ 复制失败，请手动选择文本复制');
                    }
                }
            });

            // 输入框实时更新配置
            globalSpiderInput.addEventListener('input', updateConfigJson);
            parseUrlInput.addEventListener('input', updateConfigJson);
            parseExtInput.addEventListener('input', updateConfigJson);
            wallpaperUrlInput.addEventListener('input', updateConfigJson);
            liveGroupInput.addEventListener('input', updateConfigJson);
            liveChannelNameInput.addEventListener('input', updateConfigJson);
            vipFlagsInput.addEventListener('input', updateConfigJson);
            ijkGroupSelect.addEventListener('change', function() {
                updateIjkOptionsTextarea();
                loadIjkOptions();
                updateConfigJson();
            });
            adDomainsTextarea.addEventListener('input', updateConfigJson);
            vodJarInput.addEventListener('input', updateConfigJson);

            // 初始化表单值
            function initFormValues() {
                if (config.spider) {
                    globalSpiderInput.value = config.spider;
                }
                
                // 设置VIP标识默认值
                vipFlagsInput.value = config.flags.join(',');
                
                // 初始化IJK配置显示
                updateIjkOptionsTextarea();
                loadIjkOptions();
                
                // 设置广告过滤默认值
                adDomainsTextarea.value = config.ads.join('\n');
                
                // 加载分类
                loadCategories();
                
                // 加载列表
                loadVodItems();
                loadLiveChannels();
                loadParses();
                
                // 初始化URL删除事件
                document.querySelectorAll('.remove-url').forEach(btn => {
                    btn.addEventListener('click', function() {
                        this.parentElement.remove();
                    });
                });
            }

            // 初始化页面
            initFormValues();
            updateConfigJson();
        });
    </script>
</body>
</html>